<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roberts Management Food Safety Quiz</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #fbbf24 0%, #ef4444 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); overflow: hidden; }
        .header { background: #dc2626; color: white; padding: 40px; text-align: center; }
        .header h1 { font-size: 32px; margin-bottom: 10px; }
        .content { padding: 40px; }
        input, select { width: 100%; padding: 15px; margin: 10px 0; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; }
        input:focus, select:focus { outline: none; border-color: #dc2626; }
        button { width: 100%; padding: 20px; background: #dc2626; color: white; border: none; border-radius: 10px; font-size: 20px; font-weight: bold; cursor: pointer; margin-top: 20px; }
        button:hover { background: #b91c1c; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .question { margin-bottom: 30px; }
        .question h2 { font-size: 24px; margin-bottom: 20px; }
        .option { padding: 15px; margin: 10px 0; border: 2px solid #ddd; border-radius: 10px; cursor: pointer; }
        .option:hover { background: #f3f4f6; }
        .option.selected { background: #dbeafe; border-color: #3b82f6; }
        .option.correct { background: #d1fae5; border-color: #10b981; }
        .option.wrong { background: #fee2e2; border-color: #ef4444; }
        .critical-badge { background: #fee2e2; color: #991b1b; padding: 10px; border-radius: 10px; margin-bottom: 20px; font-weight: bold; }
        .progress { background: #1e3a8a; height: 8px; border-radius: 10px; margin-bottom: 20px; }
        .progress-bar { background: #fbbf24; height: 100%; border-radius: 10px; transition: width 0.3s; }
        .score { display: inline-block; background: #fbbf24; color: #1e3a8a; padding: 10px 20px; border-radius: 10px; font-weight: bold; }
        .result-card { padding: 30px; background: #f9fafb; border-radius: 15px; margin: 20px 0; text-align: center; }
        .leaderboard-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; margin: 10px 0; background: #f9fafb; border-radius: 10px; }
        .explanation { background: #dbeafe; padding: 15px; border-radius: 10px; margin-top: 15px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div style="font-size: 60px; margin-bottom: 20px;">üçî</div>
            <h1 id="headerTitle">Roberts Management Food Safety</h1>
            <p id="headerSubtitle">McDonald's Inspection Readiness</p>
        </div>
        <div class="content" id="content"></div>
    </div>

    <script>
        const GOOGLE_URL = 'https://script.google.com/macros/s/AKfycbzxB99sgu-pWt0H_-GOVyx94RHSnb8EpohA2Yb2r1kxtS590glkrhpFrl18Vo4WOg1CeQ/exec';
        const LOCATIONS = ["Olympia", "Peters", "Duquesne", "Waterfront"];
        
        const questions = [
            {id:1,q:"What is the minimum internal temperature for FROZEN 10:1 beef patties after cooking?",opts:["145¬∞F","150¬∞F","155¬∞F","165¬∞F"],ans:2,cat:"CRITICAL - Cooking",ref:"FS2",crit:true,exp:"FROZEN 10:1 beef MUST be 155¬∞F+. CRITICAL - automatic failure if wrong."},
            {id:2,q:"What is the minimum internal temperature for FRESH 4:1 beef patties after cooking?",opts:["155¬∞F","165¬∞F","175¬∞F","180¬∞F"],ans:2,cat:"CRITICAL - Cooking",ref:"FS2-Fresh",crit:true,exp:"FRESH 4:1 beef MUST be 175¬∞F+. CRITICAL - automatic failure if wrong."},
            {id:3,q:"What is the minimum internal temperature for raw chicken products after cooking?",opts:["155¬∞F","160¬∞F","165¬∞F","170¬∞F"],ans:2,cat:"CRITICAL - Cooking",ref:"FS3",crit:true,exp:"Chicken MUST be 165¬∞F+. CRITICAL - automatic failure."},
            {id:4,q:"What is the minimum internal temperature for Filet-O-Fish portions after cooking?",opts:["145¬∞F","150¬∞F","155¬∞F","165¬∞F"],ans:2,cat:"CRITICAL - Cooking",ref:"FS4",crit:true,exp:"Filet-O-Fish MUST be 155¬∞F+. CRITICAL failure point."},
            {id:5,q:"What is the minimum internal temperature for breakfast sausage (raw pork) and breakfast steak?",opts:["145¬∞F","155¬∞F","165¬∞F","175¬∞F"],ans:1,cat:"CRITICAL - Cooking",ref:"FS5",crit:true,exp:"Sausage/steak MUST be 155¬∞F+. CRITICAL question."},
            {id:6,q:"What must be true about cooked McMuffin raw round eggs?",opts:["Yolks runny at 145¬∞F","Yolks gelled at 155¬∞F+","Yolks gelled at 145¬∞F","Any temp OK"],ans:1,cat:"CRITICAL - Cooking",ref:"FS6",crit:true,exp:"Eggs MUST have gelled yolks at 155¬∞F+. CRITICAL."},
            {id:7,q:"The on-duty manager must demonstrate what about the Food Safety Checklist?",opts:["Know location","Complete it AND take corrective action","Complete it only","Where to file"],ans:1,cat:"CRITICAL - Management",ref:"FS7",crit:true,exp:"Manager MUST demonstrate training AND corrective action. CRITICAL."},
            {id:8,q:"What indicates pest infestation causing automatic failure?",opts:["One fly","Active infestation in/near restaurant (10 feet)","Old droppings outside","Ants in parking lot"],ans:1,cat:"CRITICAL - Pest",ref:"FS1",crit:true,exp:"ANY active infestation in/near building is CRITICAL automatic failure."},
            {id:9,q:"What must be at ALL handwashing sinks?",opts:["Just soap","Just water","Warm water, soap, towels, signage","Cold water & soap"],ans:2,cat:"Hygiene - 5pts",ref:"FS9",crit:false,exp:"Sinks need warm water, soap, towels, signage. 5 points."},
            {id:10,q:"What handwashing system must be in place?",opts:["Wash when want","Hourly AND activity-based for ALL","Once per shift","Only when dirty"],ans:1,cat:"Hygiene - 5pts",ref:"FS10",crit:false,exp:"Hourly AND activity-based handwashing required. 5 points."},
            {id:11,q:"What color gloves for raw meat/poultry at grill?",opts:["Any color","Blue or colored","Clear only","No gloves"],ans:1,cat:"Hygiene - 5pts",ref:"FS18",crit:false,exp:"Blue/colored gloves prevent cross-contamination. 5 points."},
            {id:12,q:"Walk-in freezers must keep products at:",opts:["10¬∞F or below","5¬∞F or below","0¬∞F or below","Any frozen"],ans:2,cat:"Temp Control - 5pts",ref:"FS23",crit:false,exp:"Freezers MUST be 0¬∞F or below. 5 points."},
            {id:13,q:"Walk-in refrigerators must keep products at:",opts:["45¬∞F or below","42¬∞F or below","40¬∞F or below","38¬∞F or below"],ans:2,cat:"Temp Control - 5pts",ref:"FS24",crit:false,exp:"Refrigerators MUST be 40¬∞F or below. 5 points."},
            {id:14,q:"Pyrometer (thermometer) must be:",opts:["Just work","Clean, calibrated, working, used correctly","Working & stored","Any functioning"],ans:1,cat:"Equipment - 5pts",ref:"FS27",crit:false,exp:"Pyrometer must be clean, calibrated, working correctly, AND used correctly. 5 points."},
            {id:15,q:"All food, packaging, equipment, chemicals must be from:",opts:["Any supplier","Approved sources","Cheapest","Local"],ans:1,cat:"Sourcing - 5pts",ref:"FS28",crit:false,exp:"ALL items MUST be from approved sources. 5 points."},
            {id:16,q:"When can employee with vomiting/diarrhea work?",opts:["After 24hrs","After symptoms stop","Per regulations (managers must know)","When feel better"],ans:2,cat:"Health - 5pts",ref:"FS29",crit:false,exp:"Managers MUST understand return-to-work regulations. 5 points."},
            {id:17,q:"How many days of Daily Food Safety Checklists must be available?",opts:["30 days","45 days","60 days","90 days"],ans:2,cat:"Documentation - 5pts",ref:"FS31",crit:false,exp:"Last 60 days required. 5 points."},
            {id:18,q:"How often sanitize UHC trays and utensils?",opts:["Every 2hrs","Every 4hrs","Every 6hrs","Once per shift"],ans:1,cat:"Sanitization - 3pts",ref:"FS13",crit:false,exp:"At least every 4 hours. 3 points."},
            {id:19,q:"Minimum wash water temp for back sink?",opts:["100¬∞F","110¬∞F","120¬∞F","130¬∞F"],ans:1,cat:"Sanitization - 3pts",ref:"FS13",crit:false,exp:"110¬∞F or higher required. 3 points."},
            {id:20,q:"Leftover heated foods and expired UHC products must be:",opts:["Saved","Discarded","Re-heated","Cooled & stored"],ans:1,cat:"Time-Temp - 3pts",ref:"FS26",crit:false,exp:"ALL leftover heated foods MUST be discarded. 3 points."}
        ];

        let app = {
            screen: 'login',
            user: null,
            quiz: [],
            current: 0,
            selected: null,
            showExp: false,
            score: 0,
            answers: [],
            leaderboard: []
        };

        function init() {
            loadLeaderboard();
            showLogin();
        }

        function showLogin() {
            document.getElementById('content').innerHTML = `
                <div style="max-width: 500px; margin: 0 auto;">
                    <label style="display: block; margin: 20px 0 10px; font-weight: bold;">Your Name</label>
                    <input type="text" id="name" placeholder="Enter your full name">
                    
                    <label style="display: block; margin: 20px 0 10px; font-weight: bold;">Your Location</label>
                    <select id="location">
                        <option value="">Select your restaurant</option>
                        ${LOCATIONS.map(l => `<option value="${l}">${l}</option>`).join('')}
                    </select>
                    
                    <button onclick="login()">Start Training</button>
                    <button onclick="showLeaderboard()" style="background: #f59e0b; margin-top: 10px;">View Leaderboard</button>
                </div>
            `;
        }

        function login() {
            const name = document.getElementById('name').value.trim();
            const location = document.getElementById('location').value;
            if (name && location) {
                app.user = {
                    name: name,
                    location: location,
                    avatar: name.split(' ').map(n => n[0]).join('').toUpperCase()
                };
                showHome();
            }
        }

        function showHome() {
            document.getElementById('content').innerHTML = `
                <div class="critical-badge">
                    ‚ö†Ô∏è Critical Questions = Automatic Failure<br>
                    <small>Missing even ONE critical question in a real inspection means you FAIL.</small>
                </div>
                
                <div style="background: #fef3c7; padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                    <div style="display: flex; align-items: center; gap: 20px;">
                        <div style="width: 80px; height: 80px; background: #dc2626; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 32px; font-weight: bold;">
                            ${app.user.avatar}
                        </div>
                        <div>
                            <h2 style="font-size: 28px; margin-bottom: 5px;">${app.user.name}</h2>
                            <p style="color: #666; font-size: 18px;">${app.user.location}</p>
                        </div>
                    </div>
                </div>
                
                <button onclick="startQuiz()">Start Daily Quiz (13 Questions)</button>
                <button onclick="showLeaderboard()" style="background: #f59e0b; margin-top: 10px;">View Leaderboard</button>
                <button onclick="showLogin()" style="background: #6b7280; margin-top: 10px;">Change Manager</button>
            `;
        }

        function startQuiz() {
            const crit = questions.filter(q => q.crit);
            const nonCrit = questions.filter(q => !q.crit);
            app.quiz = [...crit, ...nonCrit.sort(() => Math.random() - 0.5).slice(0, 5)].sort(() => Math.random() - 0.5);
            app.current = 0;
            app.score = 0;
            app.selected = null;
            app.showExp = false;
            app.answers = [];
            showQuestion();
        }

        function showQuestion() {
            const q = app.quiz[app.current];
            const prog = ((app.current + 1) / app.quiz.length) * 100;
            
            document.getElementById('content').innerHTML = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <span style="font-weight: bold;">Question ${app.current + 1} of ${app.quiz.length}</span>
                    <span class="score">‚≠ê ${app.score} pts</span>
                </div>
                
                <div class="progress"><div class="progress-bar" style="width: ${prog}%"></div></div>
                
                ${q.crit ? '<div class="critical-badge">‚ö†Ô∏è CRITICAL QUESTION - Automatic failure if wrong in real inspection</div>' : ''}
                
                <div class="question">
                    <div style="background: ${q.crit ? '#fee2e2' : '#dbeafe'}; color: ${q.crit ? '#991b1b' : '#1e40af'}; display: inline-block; padding: 8px 16px; border-radius: 20px; font-weight: bold; margin-bottom: 15px;">
                        ${q.cat}
                    </div>
                    <h2>${q.q}</h2>
                </div>
                
                <div id="options">
                    ${q.opts.map((opt, i) => `
                        <div class="option ${app.selected === i ? 'selected' : ''}" onclick="selectOption(${i})">
                            ${opt}
                        </div>
                    `).join('')}
                </div>
                
                <div id="explanation" class="${app.showExp ? '' : 'hidden'}">
                    <div class="explanation">
                        <strong>Explanation:</strong><br>${q.exp}
                    </div>
                </div>
                
                <button onclick="${app.showExp ? 'nextQuestion()' : 'submitAnswer()'}" ${!app.showExp && app.selected === null ? 'disabled' : ''}>
                    ${app.showExp ? (app.current < app.quiz.length - 1 ? 'Next Question' : 'View Results') : 'Submit Answer'}
                </button>
            `;
        }

        function selectOption(i) {
            if (!app.showExp) {
                app.selected = i;
                showQuestion();
            }
        }

        function submitAnswer() {
            const q = app.quiz[app.current];
            const correct = app.selected === q.ans;
            app.answers.push({correct: correct, critical: q.crit});
            if (correct) app.score += 10;
            app.showExp = true;
            
            // Update option styles
            const opts = document.querySelectorAll('.option');
            opts[q.ans].className = 'option correct';
            if (app.selected !== q.ans) {
                opts[app.selected].className = 'option wrong';
            }
            
            document.getElementById('explanation').className = '';
            document.querySelector('button').textContent = app.current < app.quiz.length - 1 ? 'Next Question' : 'View Results';
            document.querySelector('button').disabled = false;
            document.querySelector('button').onclick = nextQuestion;
        }

        function nextQuestion() {
            if (app.current < app.quiz.length - 1) {
                app.current++;
                app.selected = null;
                app.showExp = false;
                showQuestion();
            } else {
                saveScore();
                showResults();
            }
        }

        function showResults() {
            const pct = (app.score / (app.quiz.length * 10)) * 100;
            const crit = app.answers.filter(a => a.critical);
            const critCorrect = crit.filter(a => a.correct).length;
            const critMissed = crit.filter(a => !a.correct);
            
            document.getElementById('content').innerHTML = `
                ${critMissed.length > 0 ? `
                    <div style="background: #fee2e2; border: 3px solid #ef4444; padding: 30px; border-radius: 15px; margin-bottom: 30px;">
                        <h2 style="color: #991b1b; font-size: 28px; margin-bottom: 10px;">‚ö†Ô∏è INSPECTION FAILURE</h2>
                        <p style="color: #991b1b; font-size: 18px;">
                            You missed <strong>${critMissed.length} CRITICAL question(s)</strong>. 
                            In a real Ecosure inspection, you would automatically FAIL.
                        </p>
                    </div>
                ` : ''}
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div class="result-card" style="background: linear-gradient(135deg, #fbbf24, #f59e0b);">
                        <div style="font-size: 48px; color: white; font-weight: bold; margin-bottom: 10px;">${app.score}</div>
                        <div style="color: white; font-size: 20px; font-weight: bold;">Total Points</div>
                        <div style="color: white; font-size: 18px; margin-top: 5px;">${pct.toFixed(0)}% Correct</div>
                    </div>
                    
                    <div class="result-card" style="background: linear-gradient(135deg, ${critMissed.length === 0 ? '#10b981, #059669' : '#ef4444, #dc2626'});">
                        <div style="font-size: 48px; color: white; font-weight: bold; margin-bottom: 10px;">${critCorrect}/${crit.length}</div>
                        <div style="color: white; font-size: 20px; font-weight: bold;">Critical Questions</div>
                        <div style="color: white; font-size: 18px; margin-top: 5px;">${critMissed.length === 0 ? 'PASS ‚úì' : 'FAIL ‚úó'}</div>
                    </div>
                </div>
                
                <div style="background: ${critMissed.length === 0 && pct >= 80 ? '#d1fae5' : '#fef3c7'}; padding: 30px; border-radius: 15px; text-align: center; margin-bottom: 30px;">
                    <h2 style="font-size: 24px; color: ${critMissed.length === 0 && pct >= 80 ? '#065f46' : '#92400e'}; margin-bottom: 10px;">
                        ${critMissed.length === 0 && pct >= 80 ? 'Excellent! You passed!' : critMissed.length === 0 ? 'Good! Critical passed, review missed questions.' : 'CRITICAL FAILURE - Review immediately!'}
                    </h2>
                    ${pct >= 80 && critMissed.length === 0 ? '<p style="color: #065f46; font-weight: bold;">‚úì Added to leaderboard!</p>' : ''}
                </div>
                
                <button onclick="showHome()">Back to Home</button>
                <button onclick="showLeaderboard()" style="background: #f59e0b; margin-top: 10px;">View Leaderboard</button>
                <button onclick="startQuiz()" style="background: #10b981; margin-top: 10px;">Retake Quiz</button>
            `;
        }

        async function saveScore() {
            const pct = (app.score / (app.quiz.length * 10)) * 100;
            if (pct >= 80) {
                const crit = app.answers.filter(a => a.critical);
                const critCorrect = crit.filter(a => a.correct).length;
                const critMastery = Math.round((critCorrect / crit.length) * 100);
                
                const entry = {
                    name: app.user.name,
                    location: app.user.location,
                    avatar: app.user.avatar,
                    score: app.score,
                    criticalMastery: critMastery,
                    date: new Date().toLocaleDateString()
                };
                
                try {
                    await fetch(GOOGLE_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({action: 'addScore', data: entry})
                    });
                    await loadLeaderboard();
                } catch(e) {
                    console.log('Error saving:', e);
                }
            }
        }

        async function loadLeaderboard() {
            try {
                const response = await fetch(GOOGLE_URL + '?action=getLeaderboard');
                const data = await response.json();
                if (data.leaderboard) {
                    app.leaderboard = data.leaderboard;
                }
            } catch(e) {
                console.log('Error loading leaderboard:', e);
            }
        }

        function showLeaderboard() {
            loadLeaderboard().then(() => {
                document.getElementById('headerTitle').textContent = 'Manager Leaderboard';
                document.getElementById('headerSubtitle').textContent = 'Top Performers - Inspection Readiness';
                
                document.getElementById('content').innerHTML = `
                    ${app.leaderboard.length === 0 ? `
                        <div style="text-center; padding: 60px 20px;">
                            <div style="font-size: 80px; margin-bottom: 20px;">üéØ</div>
                            <h2 style="font-size: 24px; color: #666; margin-bottom: 10px;">No managers on leaderboard yet!</h2>
                            <p style="color: #999;">Complete a quiz with 80% or higher to appear here.</p>
                        </div>
                    ` : `
                        <div>
                            ${app.leaderboard.map((m, i) => `
                                <div class="leaderboard-item">
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <div style="font-size: 24px; font-weight: bold; color: ${i < 3 ? '#f59e0b' : '#999'}; width: 40px;">
                                            #${i + 1}
                                        </div>
                                        <div style="width: 50px; height: 50px; background: #dc2626; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                            ${m.avatar}
                                        </div>
                                        <div>
                                            <div style="font-weight: bold; font-size: 18px;">${m.name}</div>
                                            <div style="color: #666; font-size: 14px;">${m.location}</div>
                                        </div>
                                    </div>
                                    <div style="text-align: right;">
                                        <div style="font-size: 24px; font-weight: bold; color: #dc2626;">${m.score}</div>
                                        <div style="font-size: 14px; color: #10b981; font-weight: bold;">${m.criticalMastery}% critical</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `}
                    
                    <div style="background: #dbeafe; padding: 20px; border-radius: 15px; margin-top: 30px;">
                        <strong style="color: #1e40af;">üéØ Critical Mastery Explained</strong><br>
                        <span style="color: #1e40af;">Shows performance on CRITICAL questions (FS1-FS7). These are automatic failure items. Aim for 100%!</span>
                    </div>
                    
                    <button onclick="${app.user ? 'showHome()' : 'showLogin()'}">
                        ${app.user ? 'Back to Home' : 'Take Quiz'}
                    </button>
                `;
            });
        }

        init();
    </script>
</body>
</html>